---
title: "HonoãŒè¿”ã™JSONã®å‹ã‚’æ˜ç¤ºã—ãŸã„!"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["hono", "typescript"]
published: true
---

# çµè«–

```ts
ReturnType<typeof c.json<...>>
```

# ã¯ã˜ã‚ã«

Honoã€ä¾¿åˆ©ã§ã™ã‚ˆã­ã€‚
ã—ã‹ã—ã€Honoã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã€`c.json()`ãŒè¿”ã™JSONã®å‹ã‚’æ˜ç¤ºã—ãŸã„ã¨ããŒã‚ã‚Šã¾ã™ã€‚

```ts
export type Ok<T> = { ok: true; value: T };
export type Err<E = string> = { ok: false; error: E };

export type Result<T, E = string> = Ok<T> | Err<E>;
```

ç§ã¯ã€ã“ã®ã‚ˆã†ãª`Result`å‹ã‚’ã‚ˆãä½¿ã„ã¾ã™ã€‚Honoã§è¿”ã™JSONã‚‚ã“ã®`Result`å‹ã«æ²¿ã†ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```ts
const app = new Hono().get("/", async (c) => {
  const res = await processPossibleFail();

  if (!res.success) {
    return c.json({ ok: false, error: res.error }, 500);
  }

  return c.json({ ok: true, value: res.value }, 200);
});
```

ã“ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚ã“ã‚Œã¯returnãŒ2ç®‡æ‰€ãªã®ã§ã¾ã ã„ã„æ–¹ã§ã™ãŒã€æ—©æœŸreturnã®æ•°ãŒå¢—ãˆã¦ãã‚‹ã¨ã€ã™ã¹ã¦ã®returnã§æœŸå¾…ã—ãŸå‹ã«ãªã£ã¦ã„ã‚‹ã‹ä¸å®‰ã«ãªã£ã¦ãã¾ã™ã€‚ã²ã¨ã¤ãšã¤`satisfies`ãªã©ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã®ã‚‚é¢å€’ã§ã™ã€‚

ãã“ã§ã€ãƒãƒ³ãƒ‰ãƒ©ãŒè¿”ã™å‹ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚

# ä¾‹

```ts
const app = new Hono().get(
  "/",
  async (c): Promise<ReturnType<typeof c.json<Result<{ text: string }>>>> => {
    const res = await processPossibleFail();

    if (!res.success) {
      return c.json({ ok: false, error: res.error }, 500);
    }

    const text = res.value.text;

    return c.json({ ok: true, value: { text } }, 200);
  }
);
```

# ãŠã‚ã‚Šã«

èª¿ã¹ã¦ã‚‚å‡ºã¦ã“ãªã‹ã£ãŸã®ã§è¨˜äº‹ã«ã—ãŸã®ã§ã™ãŒã€ã‚‚ã—ã‹ã—ãŸã‚‰ã‚‚ã£ã¨ã„ã„æ–¹æ³•ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã¡ãªã¿ã«ã€æ¯å›`ReturnType<typeof c.json<...>>`ã¨æ›¸ãã®ã¯é¢å€’ãªã®ã§ã€

```ts
type HonoJSON<T> = ReturnType<Context['json']<T>>
```

ã¨ã„ã†é¢¨ã«ã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€ãƒ€ãƒ¡ã¿ãŸã„ã§ã™ã€‚
