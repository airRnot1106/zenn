---
title: "Next.js 15 & Storybook v8.6ã§SVGRã‚’å°å…¥ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ¤˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["svgr", "svg", "nextjs", "storybook"]
published: true
---

SVGã‚’Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ãˆã‚‹[SVGR](https://react-svgr.com/)ã¯ã€UIé–‹ç™ºã«ãŠã„ã¦éå¸¸ã«ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€**Next.js 15**ã¨**Storybook v8.6**ã®ä¸¡æ–¹ã§SVGRã‚’å°å…¥ã—ã€SVGã‚’å¿«é©ã«æ‰±ã†ãŸã‚ã®è¨­å®šæ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

## Next.jsã§ã®SVGRå°å…¥

### ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pnpm add -D @svgr/webpack
```

### next.config.tsã®è¨­å®š

https://react-svgr.com/docs/next/

SVGRå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã„ã€`next.config.ts`ã«ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts:next.config.ts
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  /* config options here */
  webpack(config) {
    // Grab the existing rule that handles SVG imports
    // @ts-expect-error config.module.rules is not typed
    const fileLoaderRule = config.module.rules.find((rule) =>
      rule.test?.test?.('.svg'),
    );

    config.module.rules.push(
      // Reapply the existing rule, but only for svg imports ending in ?url
      {
        ...fileLoaderRule,
        test: /\.svg$/i,
        resourceQuery: /url/, // *.svg?url
      },
      // Convert all other *.svg imports to React components
      {
        test: /\.svg$/i,
        issuer: fileLoaderRule.issuer,
        resourceQuery: { not: [...fileLoaderRule.resourceQuery.not, /url/] }, // exclude if *.svg?url
        use: [{ loader: '@svgr/webpack', options: { icon: true } }],
      },
    );

    // Modify the file loader rule to ignore *.svg, since we have it handled now.
    fileLoaderRule.exclude = /\.svg$/i;

    return config;
  },
};

export default nextConfig;
```

:::message
`icon: true`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€`viewBox`å±æ€§ãŒåæ˜ ã•ã‚Œã€SVGã‚¢ã‚¤ã‚³ãƒ³ã¨ã—ã¦ã®åˆ©ç”¨ãŒä¾¿åˆ©ã«ãªã‚Šã¾ã™ã€‚
:::

### å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®è¿½åŠ 

TypeScriptç’°å¢ƒã§ã¯ã€SVGã‚¤ãƒ³ãƒãƒ¼ãƒˆç”¨ã®å‹å®šç¾©ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```ts:svgr.d.ts
declare module '*.svg' {
  import type { FC, SVGProps } from 'react';
  const content: FC<SVGProps<SVGElement>>;
  export default content;
}

declare module '*.svg?url' {
  // biome-ignore lint/suspicious/noExplicitAny: any is required here
  const content: any;
  export default content;
}
```

---

## Storybookã§ã®SVGRå°å…¥

Storybookã§ã‚‚SVGã‚’Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æ‰±ã†ã«ã¯ã€`vite-plugin-svgr`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

### ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pnpm add -D vite-plugin-svgr
```

### .storybook/main.tsã®è¨­å®š

https://scrapbox.io/ygkn/@storybook%2Fexperimental-nextjs-vite_%E3%81%A7_SVGR_%E3%82%92%E4%BD%BF%E3%81%86%E3%81%AB%E3%81%AF

ã“ã¡ã‚‰ã®è¨˜äº‹ã«å¾“ã„ã€`.storybook/main.ts`ã«ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts:.storybook/main.ts
import type { StorybookConfig } from '@storybook/experimental-nextjs-vite';
import svgr from 'vite-plugin-svgr';
import tsconfigPaths from 'vite-tsconfig-paths';

const config: StorybookConfig = {
  stories: ['../src/**/*.stories.@(js|jsx|mjs|ts|tsx)'],
  addons: [
    '@storybook/addon-essentials',
    '@storybook/addon-onboarding',
    '@chromatic-com/storybook',
    '@storybook/experimental-addon-test',
  ],
  framework: {
    name: '@storybook/experimental-nextjs-vite',
    options: {},
  },
  staticDirs: ['../public'],
  viteFinal(config) {
    config.plugins?.push(tsconfigPaths());
    config.plugins?.push(
      svgr({
        include: /\.svg$/,
      }),
    );
    config.plugins = config.plugins?.flat().map((plugin) => {
      if (
        typeof plugin === 'object' &&
        plugin !== null &&
        'name' in plugin &&
        plugin.name === 'vite-plugin-storybook-nextjs-image'
      ) {
        return {
          ...plugin,
          resolveId(id, importer) {
            if (id.endsWith('.svg')) {
              return null;
            }
            // @ts-expect-error `resolveId` hook of vite-plugin-storybook-nextjs-image is a function
            return plugin.resolveId(id, importer);
          },
        };
      }
      return plugin;
    });
    return config;
  },
};
export default config;
```
